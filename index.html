<html lang=”en”>

<head>
	<meta charset="utf-8">
	<meta http-equiv="x-ua-compatible" content="ie=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<!-- Name of the app -->
	<title>Redoxon</title>
	<!-- Link to main style sheet -->
	<link rel="stylesheet" href="style.css">
	<link href="https://fonts.googleapis.com/css?family=Montserrat&display=swap" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/exif-js"></script>
	<script src='download.js'></script>
	<script src="./js/main.js"></script>
</head>

<body>
	<div class='poster-only-desktop'>
		<img class='logo' src='images/Logo.png' />
		<img class='poster' src="images/poster-only-desktop.png" />
	</div>
	<img class='poster-rotate' src="images/please_rotate_your_phone.png" />

	<body>

		<video width="400" controls>
			<source src='http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4'
				type="video/mp4">
			Your browser does not support HTML5 video.
		</video>

		<p>These are the frames' images generated by getVideoImage():</p>
		<ol id="olFrames"></ol>

		<script type="text/JavaScript">
		function getVideoImage(path, secs, callback) {
		  var me = this, video = document.createElement('video');
		  video.onloadedmetadata = function() {
			if ('function' === typeof secs) {
			  secs = secs(this.duration);
			}
			this.currentTime = Math.min(Math.max(0, (secs < 0 ? this.duration : 0) + secs), this.duration);
		  };
		  video.onseeked = function(e) {
			var canvas = document.createElement('canvas');
			canvas.height = video.videoHeight;
			canvas.width = video.videoWidth;
			var ctx = canvas.getContext('2d');
			ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
			var img = new Image();
			img.src = canvas.toDataURL();
			callback.call(me, img, this.currentTime, e);
		  };
		  video.onerror = function(e) {
			callback.call(me, undefined, undefined, e);
		  };
		  video.src = path;
		}
		
		function showImageAt(secs) {
		  var duration;
		  getVideoImage('http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4',
			function(totalTime) {
			  duration = totalTime;
			  return secs;
			},
			function(img, secs, event) {
			  if (event.type == 'seeked') {
				var li = document.createElement('li');
				li.innerHTML += '<b>Frame at second ' + secs + ':</b><br />';
				li.appendChild(img);
				document.getElementById('olFrames').appendChild(li);
				if (duration >= ++secs) {
				  showImageAt(secs);
				};
			  }
			}
		  );
		}
		showImageAt(0);
		</script>

		<p>
			Video courtesy of
			<a href="https://www.bigbuckbunny.org/" target="_blank">Big Buck Bunny</a>.
		</p>
	</body>


	<!-- Reference to your JavaScript file -->
	<script>

		var type_of_file //check type of file upload or capture

		//upload image
		const imageCamera = document.getElementById('image-camera')
		const uploadImage = document.getElementById('upload-image')
		imageCamera.onclick = () => uploadImage.click()
		imageCamera.onclick = () => { type_of_file = 'image' }

		//video
		const videoCamera = document.getElementById('video-camera')
		const uploadVideo = document.getElementById('upload-video')
		videoCamera.onclick = () => uploadVideo.click()
		videoCamera.onclick = () => { type_of_file = 'video' }

		const canvas = document.getElementById("myCanvas");
		const ctx = canvas.getContext("2d");
		var canvas1 = document.getElementById("rotate-canvas");
		var ctx1 = canvas1.getContext("2d");
		const frame = new Image()
		frame.src = './images/photoframe.png'

		canvas.width = innerWidth * 0.71
		canvas.height = innerWidth * 0.71

		//open popup
		var modal = document.getElementById("myModal");

		var btn = document.getElementById("myBtnModal");

		var span = document.getElementsByClassName("close")[0];

		btn.onclick = function () {
			modal.style.display = "block";
		}

		span.onclick = function () {
			modal.style.display = "none";
		}
		window.onclick = function (event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
		}

		// Converts canvas to an image
		function convertCanvasToImage(canvas) {
			var image = new Image();
			image.src = canvas.toDataURL("image/png");
			return image;
		}

		//download image
		// document.getElementById('myBtnModal').onclick= function(){
		// 	modal.style.display = "block";
		// 	var image = convertCanvasToImage(document.getElementById("myCanvas"));
		// 	download(image.src, 'image-redoxon', 'png');
		// }

		// function download format download(file.src,'name','type of file')

		//upload video
		UploadVideo = (value) => {
			var source = value[0]
			var reader = new FileReader();
			var video_preview = document.getElementById("video-preview")
			reader.onloadend = function () {
				video_preview.src = reader.result;

				//download video
				document.getElementById('myBtnModal').onclick = function () {
					modal.style.display = "block";
					download(video_preview.src, 'video-redoxon', 'mp4');
				}
			}
			if (source) {
				reader.readAsDataURL(source);
			} else {
				video_preview.src = "";
			}

		}

		document.getElementById('myBtnModal').onclick = function () {
			modal.style.display = "block";
			var image = convertCanvasToImage(document.getElementById("myCanvas"));
			alert(type_of_file)
			// var anchor = document.createElement('a');

			// console.log(anchor);
			// anchor.setAttribute('href', image.src);
			// anchor.setAttribute('download', 'image.png');
			// anchor.click();
		}
	</script>
</body>

</html>